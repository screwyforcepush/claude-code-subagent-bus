<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Branch Visualization Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1f2937;
            color: white;
            font-family: system-ui;
        }
        .test-container {
            width: 100%;
            height: 400px;
            border: 1px solid #374151;
            border-radius: 8px;
            margin: 20px 0;
        }
        .info {
            background: #374151;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .scenario {
            background: #4b5563;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Agent Branch Visualization Fix Test</h1>
    
    <div class="info">
        <h2>Test Scenarios</h2>
        <p>This test validates the agent branch visualization fixes for:</p>
        <ul>
            <li>Proper branch start/end points connecting to orchestrator line</li>
            <li>Alternating lane positioning (above/below orchestrator)</li>
            <li>Correct label positioning on curved paths</li>
            <li>In-progress agents without endTime</li>
            <li>Minimum branch width for readability</li>
        </ul>
    </div>

    <div class="scenario">
        <h3>Scenario 1: Mixed Agent States</h3>
        <p>Tests completed agents (with merge-back) and in-progress agents (open-ended)</p>
    </div>
    
    <div class="scenario">
        <h3>Scenario 2: Overlapping Time Ranges</h3>
        <p>Tests agents with overlapping time ranges to verify lane separation</p>
    </div>
    
    <div class="scenario">
        <h3>Scenario 3: Short Duration Agents</h3>
        <p>Tests minimum branch width enforcement for very short-duration agents</p>
    </div>

    <div class="info">
        <h2>Expected Behavior</h2>
        <ul>
            <li><strong>Branch Paths:</strong> Smooth curves from orchestrator to agent lane and back</li>
            <li><strong>Lane Assignment:</strong> Alternating above/below pattern (lane 1 above, lane 2 below, etc.)</li>
            <li><strong>Labels:</strong> Centered on the horizontal portion of agent paths</li>
            <li><strong>In-Progress:</strong> Open branches that don't merge back to orchestrator</li>
            <li><strong>Minimum Width:</strong> All branches have readable width regardless of duration</li>
        </ul>
    </div>

    <div class="info">
        <h2>Key Fixes Applied</h2>
        <ol>
            <li><strong>getAgentLaneY:</strong> Alternating lane positioning above/below orchestrator</li>
            <li><strong>getSessionAgentPath:</strong> Improved curve calculations with adaptive control points</li>
            <li><strong>getAgentLabelPosition:</strong> Better label centering on agent paths</li>
            <li><strong>SessionDataAdapter:</strong> Robust lane index assignment and mock data generation</li>
            <li><strong>Edge Cases:</strong> Proper handling of agents without endTime</li>
        </ol>
    </div>

    <script>
        console.log('Agent Branch Visualization Test Page Loaded');
        console.log('To test the fixes:');
        console.log('1. Start the development server: npm run dev');
        console.log('2. Navigate to the Sessions Timeline tab');
        console.log('3. Verify agent branches display correctly');
        console.log('4. Check that completed agents merge back to orchestrator');
        console.log('5. Verify in-progress agents have open-ended branches');
        console.log('6. Confirm labels are properly positioned');
    </script>
</body>
</html>